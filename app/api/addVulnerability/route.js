import connectToDatabase from "@/lib/db";
import DatauriParser from "datauri/parser";
import Vulnerability from "@/model/VulnerabilityModel";

export const dynamic = "force-dynamic";

export async function POST(request) {
  try {
    await connectToDatabase();
    const parser = new DatauriParser();
    const formData = await request.formData();

    const vulnerabilityName = formData.get("vulnerabilityName");
    const description = formData.get("description");
    const impact = formData.get("impact");
    const recommendation = formData.get("recommendation");

    const newVulnerability = await Vulnerability.create({
      vulnerabilityName,
      description,
      impact,
      recommendation,
    });

    return new Response(
      JSON.stringify({
        status: "success",
        data: newVulnerability,
      }),
      {
        headers: { "Content-Type": "application/json" },
        status: 201,
      }
    );
  } catch (error) {
    console.error(error);
    return new Response(
      JSON.stringify({ status: "fail", error: error.message }),
      {
        headers: { "Content-Type": "application/json" },
        status: 500,
      }
    );
  }
}
